{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",

  "background": "transparent",
  "width": "container",
  "height": "container",
  "autosize": { "type": "fit", "contains": "padding" },
  "padding": { "top": 6, "right": 6, "bottom": 24, "left": 6 },

  "params": [
    {
      "name": "YearBar",
      "value": 2016,
      "bind": { "input": "range", "min": 1896, "max": 2016, "step": 4, "name": "Year: " }
    },
    {
      "name": "SeasonSel",
      "value": "Summer",
      "bind": { "input": "select", "options": ["Summer","Winter","All"], "name": "Season: " }
    }
  ],

  "data": {
    "url": "https://raw.githubusercontent.com/davidlie883/3179-Assignment2/main/datasets/olympic_medals_by_noc_year_counts.csv",
    "format": { "type": "csv" }
  },

  "transform": [
    { "filter": "datum.Medal === 'Gold' || datum.Medal === 'Silver' || datum.Medal === 'Bronze'" },
    { "filter": "toNumber(datum.Year) == YearBar" },
    {
      "filter": "SeasonSel === 'All' ? true : datum.Season === SeasonSel"
    },

    { "aggregate": [{ "op": "sum", "field": "medal_count", "as": "count" }], "groupby": ["NOC","Medal"] },

    { "joinaggregate": [{ "op": "sum", "field": "count", "as": "Total" }], "groupby": ["NOC"] },

    {
      "window": [{ "op": "rank", "as": "rk" }],
      "sort": [{ "field": "Total", "order": "descending" }]
    },
    { "filter": "datum.rk <= 10" }
  ],

  "mark": { "type": "bar", "cornerRadiusEnd": 4 },

  "encoding": {
    "y": {
      "field": "NOC",
      "type": "nominal",
      "sort": "-x",
      "axis": { "labelColor": "#e8eaed", "title": null }
    },
    "x": {
      "aggregate": "sum",
      "field": "count",
      "type": "quantitative",
      "axis": { "labelColor": "#e8eaed", "gridColor": "#242a33", "title": "Medals" },
      "stack": "zero"
    },
    "color": {
      "field": "Medal",
      "type": "nominal",
      "scale": { "domain": ["Gold","Silver","Bronze"], "range": ["#FFD166","#C0C0C0","#CD7F32"] },
      "legend": { "orient": "bottom", "direction": "horizontal", "labelColor": "#e8eaed", "title": "Medal" }
    },
    "tooltip": [
      { "field": "NOC", "title": "NOC" },
      { "field": "Medal", "title": "Type" },
      { "field": "count", "title": "Count" },
      { "field": "Total", "title": "Total (All medals)" }
    ]
  },

  "config": {
    "view": { "stroke": null },
    "axis": { "domainColor": "#242a33", "tickColor": "#242a33", "labelColor": "#e8eaed", "titleColor": "#e8eaed", "gridColor": "#242a33" },
    "legend": { "labelColor": "#e8eaed", "titleColor": "#e8eaed" }
  }
}
